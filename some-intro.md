## Небольшая предыстория и краткая история моей установки хакинтош

Я еще году в 2015-2016 заинтересовался хакинтошем, когда купил свой первый ноутбук и это был HP Pavilion 15 на Intel Core i5-6200U (Skylake) и тогда пытался установить OS X 10.11 Ela Capitan на свой ноутбук. С горем пополам я установил, вроде бы, как раз El Capitan на ноутбук. Мой хакинтош на ноутбуке работал довольно глючно, нестабильно, и мне неособо комфортно было им пользоваться.

Спустя несколько лет я установил macOS Mojave, установка и настройка получилась тоже довольно глючной и мне также было некомфортно в macOS на этом ноутбуке, да и само устройство поистрепалось и я его продал.

Потом спустя время я обновил свой ПК. системный блок с AMD Phenom II B45 заменил на сборку на x79 о которой идет речь в данном репозитории (только изначально у меня было 16 ГБ ОЗУ и SSD NVMe KingSpec с aliexpress, вместо WD Black) и некоторое время я пытался разобраться с установкой и настройкой macOS Mojave на свой компьютер на x79, но свободного времени было не сильно много и я обратился к специалистам и попросил, чтобы мне установили и настроили macOS Mojave 10.14.6 (macOS Catalina на тот момент была последней стабильной macOS и, вроде, были уже первые бета версии macOS Big Sur) на последней версии Clover, которая не использовала систему квирков из OpenCore. Это была версия Clover 5119.

Прошло несколько лет, я довольно активно пользовался macOS устанавливал, тестировал и удалял много программ и довольно серьезно "засрал" macOS. Получилось даже так, что у меня откуда-то появились не скрываемые и не удаляемые 2 раздела с названием "StorageSpace". Да и последние версии программ уже давно не поддерживали macOS Mojave, например Autocad 2023 может работать только на macOS 10.15+, Archicad 26 на macOS 11+, Photoshop 2023 на macOS 11+ и так далее. В общем многие компании и разработчики не запариваются над поддержкой старых версий macOS и я принял решение не просто переустановить macOS Mojave, а установить macOS Monterey как основную систему, macOS Mojave как "запасную", которая мне пока что больше нравится и на которой я могу запускать 32-битные приложения.

На старом Clover 5119 это сделать невозможно, а многие гайды/инструкции/уроки ориентированы на OpenCore и я повелся... Потратил огромное количество времени на настройку своего хакинтош на OpenCore, но система так и не работает идеально гладко (об этом вы можете прочитать в отдельном файле). Думаю на Clover было бы лучше.

---

Я начал искать инструкции в интернете как установить хакинтош на свою платформу x79 и конечно же первое, что я нашел это сайт dortania и начал изучение OpenCore с него. Увы, в инструкции для x79 на dortania нет многих важных аспектов, без которых хакинтош не то, что не будет стабильно работать, но даже не запустится на x79. По крайней мере на китайских материнских платах. Например в гайде dortania для x79 не говорится, что нужно использовать аргумент загрузки `npci=0x2000` или `npci=0x3000`, без которого на китайских материнских платах вы просто не попадете ни на какой из этапов запуска и установки macOS. Также в dortania говорится, что комбомодуль BCM4331 не будет работать на macOS новее Catalina даже с кекстом, хотя мой опыт доказал, что это не так. Также на dortania не говорится, что для работы macOS Monterey на x79 с кекстом CpuTscSync от acidanthera нужно наличие регистра TSC_ADJUST, которого нет в процессорах Ivy Bridge и Sandy Bridge и нужно использовать другие кексты синхронизации ядер. Я даже некоторое время горел желанием исправить эти ошибки инструкции на dortania, но когда посмотрел сколько там Pull Request'ов, ожидающих рассмотрения - желание пропало.

Когда я понял, что инструкция на dortania для платформ x79 не поможет мне, я начал искать свежие папки EFI для x79 на github и форумах. выбрав наиболее подходящую под мое оборудование сборку папки EFI, я попытался запустится с нее, но на этап установки macOS Monterey мне не удавалось попасть, компьютер просто перезапускался при попытке запуска установщика macOS, хотя все аргументы для того, чтобы он не перезапускался в случае паники, были добавлены в соответствующий пункт конфига.

От бессилия и осознания того, что на хакинтош я потрачу точно больше недели, я просто уставился на компьютер и смотрел как запускается OpenCore, после таймаута запускается установщик macOS Monterey и через несколько секунд - перезапускается, и так покругу. Я наблюдал за всем этим и пытался понять что и где я сделал не так и потом после очередной перезагрузки - установщик macOS прогрузился. Я был просто в шоке и сразу вспомнил тот видео отрывок из Far Cry 3 "[о безумии](https://youtu.be/42lVxqpHk20?t=472)".

В итоге "с горем по полам" я установил macOS Monterey, миллион раз перезагружаясь, сбрасывая NVRAM в надежде, что это поможет, но потом нашел информацию о том, что чтобы macOS запускалась стабильно, нужно из DSDT удалить лишние сокеты и ядра/процессоры и оставить столько ядра/процессоры, сколько потоков в процессоре в компьютере. И это помогло.

Потом я сравнивал официальный Sample.plist с конфигом из EFI для x79, который я использовал, пытался понять какие патчи применены, что они делают и как они мне помогут, читал гайды, видео инструкции, перебирал разные варианты настройки конфига и так далее.

Когда macOS Monterey стала более-менее нормально работать, я задался вопросом о том, как заставить работать мой комбомоудль Broadcom BCM4331, спросил об этом на applelife и там мне сказали, что на macOS Monterey этот модуль работать не будет. Но я все же продолжил поиски информации и в одном из отчетом в одной группе, оказывающей платные услуги установки хакинтош я нашел информацию об успешной настройке работы BCM4331 на macOS Monterey. Это приободрило меня и в конечном итоге, вроде бы на hackintosh-monreal, я нашел информацию о том, как заставить работать кекст AirportBrcmFix для модуля BCM4331.

Потом было потрачено много времени на настройку оптимизацию хакинтоша (папки EFI и конфига), в ходе которых выяснились проблемы с Windows при загрузке с патченным DSDT (об этом в отдельном файле), о том, что лучше использовать модифицированный OpenCore, елси нужно запускать Windows, о том, что в OpenCore нет смысла в использовании ACPI патчей, при использовании своего исправленного DSDT и многое другое.

Времени потрачено много и, если вдруг, по какой-то причине, я вернусь к платформе x79, чтобы я не тратил столько же времени на разбирательство с настройкой, я и написал эту историю-инструкцию.

---

У меня уже несколько месяцев лежит материнская плата на x99 и Intel Xeon E5-2666 V3, поэтому я надеюсь в ближайшее время отправить x79 в коробку и продолжить работу на x99, а эту инструкцию и этот опыт оставить на память об x79 и как полезный материал для тех, кто тоже захочет завести хакинтош на платформе x79.