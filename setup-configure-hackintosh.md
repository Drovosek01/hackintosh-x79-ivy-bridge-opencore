## Процесс установки и настройки хакинтоша

Желательно, чтобы вы прочитали все другие файлы в этом репозитории, чтобы иметь некоторый контекст в голове.

Также вам нужно знать терминологию хакинтоша. Она хорошо описана на соответствующей странице на dortania - https://dortania.github.io/OpenCore-Install-Guide/terminology.html Нужно разбираться в настройках вашего BIOS/UEFI, в том, что такое GPT и MBR, что такое CSM, Legacy и UEFI. 

Естественно сделайте бэкапы важных файлов, потому что при установке хакинтоша "по феншую", вам нужно будет отформатировать ваш накопитель (очень очень желательно, чтобы это был SSD), но если вы хорошо разбираетесь в создании разделов, то можете создать ESP в "середине" диска, чтобы он был более 200 МБ размером и т.д.

И желательно, чтобы у вас был второй рабочий компьютер, на котором вы можете проводить эксперименты с модификацией вашей ESP и конфига и перезапускать хакинтош-ПК и т.д.

Тут будет не такой подробный гайд.

### Создание загрузочной флешки с macOS

На dortania этот этап довольно подробно расписан - https://dortania.github.io/OpenCore-Install-Guide/installer-guide/ и эти инструкции работают.

Также хочу добавить, что утилита Boot Disk Utility (BDU) из под Windows тоже может создать загрузочную флешку как с образом восстановления macOS, так и с полноценным образом macOS, если вы заранее подготовите файл `5.hfs` (который можно найти на торрент трекерах), либо скачаете образ установщика macOS в формате `.dmg` (например с [appstorrent](https://appstorrent.ru/os) или торрент трекеров) и с помощью BDU извлечете файл `5.hfs`, который она потом запишет (восстановит) на вашу флешку. Ну, а в EFI раздел флешки можно будет уже поместить как Clover, так и OpenCore
- http://cvad-mac.narod.ru/index/bootdiskutility_exe/0-5
- https://applelife.ru/threads/bdu-macos-i-clover-iz-windows-izgotovlenie-zagruzochnoj-flehshki.37189/

Кстати скачивать последние версии образов восстановления macOS утилита BDU научилась буквально [недавно](https://applelife.ru/threads/bdu-macos-i-clover-iz-windows-izgotovlenie-zagruzochnoj-flehshki.37189/page-108#post-1021641)

### Подбор кекстов

Для каждого хакинтоша это индивидуально, но для китайских материнских плат на платформе x79 этот набор, думаю, почти всегда будет идентичен.

Про все используемые кексты я писал в [файле](efi-and-config-settings.md#кексты) с итоговой настройкой EFI и конфига.

О том, что делают все эти кексты вы можете ознакомиться на страницах с этими кекстами, в документации о них, либо поискать дополнительную информацию в интернете.

Для первоначальной установки macOS Monterey понадобятся следующие кексты:

1. [VirtualSMC](https://github.com/acidanthera/VirtualSMC)
   - Либо [FakeSMC](https://github.com/CloverHackyColor/FakeSMC3_with_plugins)
2. [Lilu](https://github.com/acidanthera/Lilu)
3. [WhatEverGreen](https://github.com/acidanthera/WhateverGreen)
4. [RealtekRTL8111](https://github.com/Mieze/RTL8111_driver_for_OS_X)
   - Либо [RealtekLANv3](https://github.com/SergeySlice/RealtekLANv3)
5. [VoodooTSCSync](https://github.com/CloverHackyColor/VoodooTSCSync)
   - Либо [CpuTscSync](https://github.com/wy414012/CpuTscSync) модифицированный [китайским разработчиком](https://gitee.com/yaming-network/CpuTscSync)

Внутри кекста VoodooTSCSync в файле `Info.plist` нужно будет вписать/заменить цифру, которая обозначает количество потоков минус 1. В моем процессоре Intel Xeon E5-2670 v2 10 ядер и 20 потоков. Соответственно я вписываю значение 19.

Если ваш процессор поддерживает регистра `TSC_ADJUST` то вы можете вместо кекста VoodooTSC использовать кекст [CpuTscSync от acidanthera](https://github.com/acidanthera/CpuTscSync) вы можете выяснить наличие этого регистра в Windows с помощью AIDA64, либо в macOS с помощью MacCPUID. У процессора Intel Xeon E5-2670 v2 нет этого регистра, вот [скриншот из AIDA64](images/AIDA64-E5-2670-v2-TSC-ADJUST.png), а вот [скриншот из MacCPUID](images/MacCPUID-E5-2670-v2-TSC-ADJUST.png)

Также пока вы не сделали USBMap или аналогичный кекст или не исправили `UPC` в DSDT, вам нужно будет создать `SSDT-USB-RESET` с помощью утилиты SSDTTime и тогда с USB не должно быть проблем, по крайней мере у меня так.

Выше написан базовый набор кекстов, который нужен для установки macOS Monterey и попадания на рабочий стол, но для того, чтобы заработал весь функционал вашего компьютера и вашей macOS, нужен еще ряд дополнительных кекстов:

1. [AppleALC](https://github.com/acidanthera/AppleALC)
2. [AirportBrcmFixup](https://github.com/acidanthera/AirportBrcmFixup)
3. [FeatureUnlock](https://github.com/acidanthera/FeatureUnlock) - нужен только, если у вас есть Apple устройства. Если нет - то ничего полезного этот кекст не добавит
4. [NVMeFix](https://github.com/acidanthera/NVMeFix)

Также есть кексты, которые никак не виляют на работу macOS, но нужны только для корректного отображения информации с датчиков оборудования (частоты процессора, температуры накопителей и т.д.):
1. [Плагины VirtualSMC](https://github.com/acidanthera/VirtualSMC)
   - SMCProcessor
   - SMCSuperIO
     - либо плагины FakeSMC
2. [RadeonSensor](https://github.com/aluveitie/RadeonSensor)
   - SMCRadeonGPU

### Настройка загрузочной флешки hackintosh

После того, как вы создали загрузочную флешку с macOS (именно с macOS, а не с хакинтош), то есть на ней есть либо образ восстановления macOS, либо полный установщик macOS, то нужно настроить ESP (папку EFI) на флешке.

В принципе на dortania этот этап довольно подробно и понято расписан - https://dortania.github.io/OpenCore-Install-Guide/installer-guide/opencore-efi.html

Если вкратце, то на ESP вам нужно в папку EFI переместить папки BOOT и OC. В папке OC в папку kexts вам нужно поместить используемые вами кексты. Потом удалить ненужные драйверы из папки Drivers. Положить необходимые `.aml` файлы в папку ACPI, потом в папку OC поместить файл `Sample.plist` из папки Docs и переименовать его в `config.plist` и потом настроить этот конфиг.

### Настройка `config.plist`

Для настройки конфига для OpenCore нужно ознакомиться с официальной [документацией](https://github.com/acidanthera/OpenCorePkg/tree/master/Docs), например в виде [PDF файла](https://github.com/acidanthera/OpenCorePkg/blob/master/Docs/Configuration.pdf)

Либо [неофициальную](https://dortania.github.io/docs/) веб-версии в формате HTML [на dortania](https://dortania.github.io/docs/latest/Configuration.html)

И согласно документации, либо каким-либо [другим источникам](hackintosh-resources.md) в интернете настраиваем параметры в файле `config.plist`.

Необходимость применения немалого количества настроек выясняется только экспериментальным путем: применяете настройку (параметр) в конфиге, перезапускаете хакинтош со сбросом NVRAM (чтобы настройка применилась наверняка) и если хакинтош запустился без проблем то на всех установленных операционных системах проводите разные тесты в бенчмарках, тесты сна и так далее, чтобы выяснять не сломала ли какой-то функционал системы. Даже в самой документации для многих параметров есть заметка, что применять этот параметр нужно только в особых случаях, если вы знаете что делаете, а когда конкретно нужно это применять - не написано.

Файлы формата `.plist` можно редактировать в любом текстовом редакторе, но удобней это делать в специальных редакторах, для этих форматов файлов. Например в [ProperTree](https://github.com/corpnewt/ProperTree) или [Xplist](https://github.com/ic005k/Xiasl) или [PlistEdit Pro](https://www.fatcatsoftware.com/plisteditpro/) или [XCode](https://apps.apple.com/us/app/xcode/id497799835?mt=12)

Также есть специализированные приложения для настройки конфига загрузчика OpenCore. Например [OpenCore Configurator](https://mackie100projects.altervista.org/download-opencore-configurator/) или [OCAuxiliaryTools](https://github.com/ic005k/OCAuxiliaryTools) или [OpenCore Configurator Online](https://xieguozhong.github.io/opencoreConfiguratorOnline/), но лучше использовать редакторы именно для файлов `.plist`

Также после каждого изменения нужно желательно проверять конфиг с помощью утилиты `ocvalidate`, которая идет в комплекте с релизами OpenCore в папках `Utilities`. Как пользоваться `ocvalidate` можно ознакомиться в документации OpenCore. Также есть неофициальная онлайн версия, которая называется [Sanity Checker](https://sanitychecker.ocutils.me/)

---

О том, что в итоге изменено мной в config.plist по сравнению с Sample.plist, который идет с релизом OpenCore 0.87 я написал в [отдельном файле](efi-and-config-settings.md#настройка-configplist)

---

Также напоминаю, что в конфиге порядок кекстов и драйверов имеет значение и они подгружаются последовательно согласно порядку в конфиге.

Самый первый кекст в списке с кекстами всегда должен быть Lilu, потому что он является как бы фреймворком/библиотекой, которую многие другие кексты используют для своей работы и если на момент запуска не будет подгружен Lilu, то не будет работать тот кекст, использующий его функционал. Так я это понимаю.

А самый первый драйвер в списке драйверов должен быть `OpenRuntime.efi`

#### Драйверы UEFI

Если вас нужна только macOS Monterey, то вам скорее всего, понадобятся только эти драйвера:
- OpenRuntime.efi
- OpenCanopy.efi
- HfsPlus.efi

Первым драйвером в списке должен быть OpenRuntime.

Также я использую дополнительные драйвера:
- ResetNvramEntry.efi
  - Нужен для сброса NVRAM
- CrScreenshotDxe.efi
  - Нужен для создания скриншотов меню OpenCore
- AudioDxe.efi
  - Нужен для звука BootChime при запуске загрузчика
- ext4_x64.efi
  - Нужен для запуска Linux из OpenCore
- OpenLinuxBoot.efi
  - Нужен для запуска Linux из OpenCore

Опять же в документации OpenCore есть описание назначения драйверов и все добавляемую в папку Drivers драйвера нужно также включить в `config.plist`

#### OpenCore GUI

Я не вижу смысла в использовании OpenCore в тестово-консольном режиме, только если вы не собираетесь устанавливать 1 операционную систему и после настройки хакинтоша вообще скрыть меню выбора, чтобы при запуске компьютера запускалась сама система.

Если же планируется использовать несколько операционных систем, то меню выбора OpenCore (это меню называется Picker) будет просто необходимо и я считаю, что в таком случае нет смысла использовать его "черно-белую" текстовую версию и нужно сразу включить отображение OpenCore GUI.

Включение GUI в меню OpenCore делается легко (но сложнее, чем в Clover, т.к. в Clover отображение GUI включено изначально). Про включение GUI в OpenCore довольно подробно и понятно рассказано в [инструкции на dortania](https://dortania.github.io/OpenCore-Post-Install/cosmetic/gui.html), не вижу смысла тут повторяться.

### Первый запуск установки macOS

Когда сделана загрузочная флешка и на ней готовый настроенный ESP, если в BIOS/UEFI выбрать запуск с этой флешки, потом в меню OpenCore выбрать установку macOS Monterey и если вам повезет - вы попадете в режим восстановления macOS с первого раза. Если не повезет, то компьютер перезапустится.

Проблема заключается в том, что в DSDT есть лишние сокеты и ядра/процессора. Как это исправить в файле DSDT я описывал в [отдельном файле](efi-and-config-settings.md). Т.к. у вас еще не будет установлена macOS для использования [MaciASL](https://github.com/acidanthera/MaciASL), то просто пытайтесь после каждой автоматической перезагрузки сбрасывать NVRAM и пытаться запустить macOS снова, у меня она так со 2 или 4 раза запускалась.

Есть альтернативный вариант. Извлечь DSDT с помощью SSDTTime в Windows, потом в Windows исправить DSDT с помощью утилиты [Xiasl](https://github.com/ic005k/Xiasl) и исправленный `DSDT.aml` положить в папку `/EFI/OC/ACPI` и потом добавить этот файл в `config.plist`.

Дальше установка по стандартной схеме. macOS несколько раз перезагрузится и в меню OpenCore вам нужно будет выбирать либо пункт, который начинается со слова "Install", либо уже запускать установленную macOS и приступать к настройке учетной записи пользователя macOS.

Видео демонстрацию процессов непосредственной установки macOS Monterey можно посмотреть, например, на этих видео:
- https://youtu.be/R-eMSIiIkWo?t=319
- https://youtu.be/rhLVyHito7c?t=335
- https://youtu.be/SIVJzvdB018?t=249
- https://youtu.be/KUzgIQzf_FU?t=82

В некоторых видео используется загрузчик Clover, но в контексте установки macOS это неважно.

### Что делать после установки macOS

После того как установили macOS, создали учетную записи и попали на рабочий стол macOS Monterey - нужно перенести папку EFI с флешки на внутренний накопитель компьютера (на SSD в данном случае).

Чтобы это сделать в macOS - нужно смонтировать ESP (раздел EFI) на флешке и на SSD и потом папку EFI с флешки перемещать на ESP на SSD. Смонтировать ESP можно как используя терминал, так и разные утилиты. Я пользуюсь утилитой [MountEFI от Andrej-Antipov](https://github.com/Andrej-Antipov/MountEFI).

После этого отсоедините флешку от компьютера, перезагрузитесь в BIOS/UEFI и приоритетах очереди запуска выберите OpenCore. Он там должен быть, есть параметр `LauncherOption` в конфиге выставлен на `Full` (по крайней мере у меня так) и запуститесь с OpenCore находящегося на вашем SSD и через него запустите macOS.

Далее уже донастраиваем конфиг на и комплектующие папки EFI и после какого-либо внесения изменения сохраняем конфиг, проверяем через `ocvalidate`, перезагружаемся со сбросом NVRAM и запускаем macOS.

Когда хакинтош более-менее настроен можно, скачивать бенчмарки и проводить тесты стабильности системы в бенчмарках. Результаты моих тестов находятся в [отдельном файле](benchmarks.md).

### Настройка USB

Во многих инструкциях как текстовых так и видео, говорится что нужно настраивать USB-порты в хакинтоше, делать "легаси кекст" или что-либо еще.

Дело в том, что начиная с OS X 10.11 El Capitan компания Apple сделала так, что в macOS не может быть больше 15 USB портов. Если в хакинтоше портов больше, то, наверное, могут быть какие-то проблемы. Чтобы обойти это ограничение в 15 USB портов раньше (во времена популярности Clover и только зарождения OpenCore), для исправления этой проблемы использовали разные патчи ядра (?), которые, вроде бы, снимают это ограничение в 15 портов. Для каждой новой версии macOS энтузиасты (вроде бы, в основном, это делал пользователь daliansky), но с определенного момента в OpenCore появился параметр XhciPortLimit, который заменял применение всех этих патчей, но по информации в dortania, начиная с macOS Big Sur 11.3 включение этого параметра может приводить к плохим последствиям и в macOS 11.3 или новее некоторые рекомендуют не включать этот параметр (но в официальной документации по параметру XhciPortLimit я не нашел такой информации).

Так вот правильный путь это не применять какие-либо патчи, отменяющие ограничение в 15 USB портов, а составить так называемую карту USB, в которой будут описаны все USB порты в компьютере и отключены те (отключены для macOS конечно же), которые не помещаются в этот лимит. не обязательно первые 15, нужно чтобы было просто не более 15 USB портов. В некоторых источниках я видел информацию, что должно быть не более 15 USB портов на 1 контроллер и если USB-контроллеров в компьютере несколько, то лимит можно расширить, но я не помню где я это видел и не знаю правда ли это.

Также не стоит забывать что USB 3.0 хоть физически является 1 разъемом, но совмещает в себе 2 порта - USB 2.0 и USB 3.0, а также может быть подключен Bluetooth внутри корпуса на материнской плате и все это нужно учитывать при подсчете лимитов.

У меня получилось 6 USB 2.0 разъемов на корпусе, 3 USB 3.0 разъема (вместе с теми, что на передней панели корпуса) и 1 USB 2.0 внутри корпуса занят Bluetooth. В итоге это 13 "USB портов". Не знаю нужно ли в таком случае делать USB Mapping, я, на всякий случай, сделал.

Карту USB (USB Mapping) можно сделать с помощью следующих утилит:
1. USBMap - https://github.com/corpnewt/USBMap
2. USBToolBox - https://github.com/orgs/USBToolBox/repositories
3. Hackintool - https://github.com/benbaker76/Hackintool

А также нужный кекст для "карты USB" можно сделать вручную по гайду с [applelife](https://applelife.ru/posts/537459) или по разным [видео на ютубе](https://www.youtube.com/results?search_query=usbmap+usbports+hackintosh) или по [инструкции с dortania](https://dortania.github.io/OpenCore-Post-Install/usb/manual/manual.html).

Также можно сделать кекст `SSDT-UIAC.aml` вручную, либо при экспорте USBPorts кекстов из Hackintool этот настроенный `.aml` файл тоже экспортируется и его применение, наверное, является тем же самым, что использовать кекст USBMap или USBPorts и вместе с этим SSDT-файлом кексты USB-настройки, наверное, лучше не использовать.

Изначально при установке хакинтоша на x79 я не умел делать USB-маппинг и "по-старинке" добавил кекст USBInjectAll в папку со всеми кекстами, а также вычитал, что `SSDT-RESET-All` тоже нужен и сделал его через SSDTTime и закинул в EFI. При установке и использовании macOS я не заметил проблем с USB, но когда начал эксперименты после установки, я заметил, что отсутствие кекста USBInjectAll не влияет на работу USB и убрал его, а вот без `SSDT-RESET-All` у меня не работали USB-порты, то есть включалась macOS и я не мог не переместить курсор, не ввести пароль и пришлось принудительно перезапускать компьютер.

> Кекстов USBInjectAll уже есть несколько видов. Первый это [от RehabMan](https://bitbucket.org/RehabMan/os-x-usb-inject-all/downloads/), а другие это [от Sniki](https://github.com/Sniki/OS-X-USB-Inject-All), [от dalianky](https://github.com/daliansky/OS-X-USB-Inject-All), [от CrisHotpatch](https://github.com/CrisHotpatch/USBInjectAll) и наверное лучше тот, где более свежие изменения.

Потом на applelife [@slice подсказал](https://www.applelife.ru/threads/huananzhi-x79m-pro-razbor-poletov.2965526/page-5#post-1017751) (а он это, вроде бы, сделал по заметке другого пользователя), что можно обойтись без каких-либо SSDT и кекстов для USB, для этого нужно исправить `_UPC` в DSDT. Нужно, чтобы в `_UPC` "методах" (или как это правильно называется) в объекте с 4-мя значениями первым было значение `0xFF`, то есть такие блоки кода:
```
Name (_UPC, Package (0x04)  // _UPC: USB Port Capabilities
{
    Zero,
    0xFF,
    Zero,
    Zero
})
```
Нужно менять на такие:
```
Name (_UPC, Package (0x04)  // _UPC: USB Port Capabilities
{
    0xFF,
    0xFF,
    Zero,
    Zero
})
```
И в моем DSDT я провел поиск по подстроке "_UPC" и у меня нашлось только 2 места, где `Zero` нужно было менять на `0xFF`. И да, после этого исправления DSDT, отключение кекста `SSDT-RESET-All` не влияло на работу USB.

Но я все же решил сделать маппинг USB и вот какие текстовые гайды я нашел:
- https://www.tonymacx86.com/threads/the-new-beginners-guide-to-usb-port-configuration.286553/#post-2029768
- https://aplus.rs/2020/usb-mapping-how/
- https://elitemacx86.com/threads/how-to-map-your-usb-ports-on-macos.581/
- https://dortania.github.io/OpenCore-Post-Install/usb/

На мое удивление большинство инструкций (если не все) по настройке USB делается на примере устройств (пунктов в DSDT и IORegistryExplorer) XHC и EHC и производных от этих названий. И в о многих инструкциях говорится, что EHC это порты USB 2.0, а XHC это USB 3.0. В своем DSDT я не нашел ни XHC ни EHC ни EH и т.д. Я нашел только 2 девайса - USBE и EUSB и ни в одной инструкции такие названия почти не встречались и что из этого USB 2.0, а что USB 3.0 - непонятно.

Изначально я попытался проделать процедуру в программе Hackintool, но при подключении и отключении флешек в ее интерфейсе я не заметил изменений, поэтому воспользовался утилиотй USBMap и с помощью нее сделал кекст USBMap. разобрался с этой утилитой не с первого раза, но в итоге разобрался.

Эта утилита по итогу может выдать 2 кекста - USBMap (который для macOS Catalina 10.15 и новее) и USBMapLegacy (который для macOS Mojave 10.14 и более старых версиях) и разница между ними только в файлах `Info.plist` (из которых как раз и состоят эти кексты) только в 2х строчках на каждый контроллер. На [скриншоте](https://sun9-6.userapi.com/impg/F1gnpuWGhJ3Ha2T_q2AZIUidU1mkdkAy_UZ0rg/xQNMvjqWUI8.jpg?size=1770x878&quality=96&sign=21b5c98dce9a9b7dda2abd7efa555a9c&type=album&hash=fb613eb62b0f749cf76944c992f2c316) с разницей слева USBMapLegacy, а справа USBMap.

В итоге через утилиту USBMap сделал этот "Code Less" кекст, открыл `Info.plist` и проверил что там не закомментированных ключей `<key>port</key>` 13 штук (что соответствует 13 USB портам, которые я подсчитал выше), переместил в папку с кекстами, прописал его в конфиг OpenCore, перезагрузил компьютер, запустил USBMap снова - а там отображается 17 портов, вместо 13. Не знаю почему так и как это исправить, но какого-то негативного влияния на работу USB я не заметил.

### Настройка аудио

Изначально я использовал кекст `AppleALC` с аргументом загрузки `alcid=5` для того, чтобы звук заработал и он работал с колонок, которые подключены к заднему аудио выходу на корпусе.

В macOS звук не работает при подключении аудио устройств к аудио порту на передней панели корпуса. С кекстом AppleALC я перепробовал [все лэйауты](https://github.com/acidanthera/AppleALC/wiki/Supported-codecs) для кодека ALC662 (и даже дополнительные), но звук из аудио порта на передней панели так и не заработал.

Потом я попробовал использовать кекст [VoodooHDA](https://sourceforge.net/projects/voodoohda/files/) и начиная с macOS 11 этот кекст неполучится использовать в папке EFI, нужно его переместить в папку `/Library/Extensions`, потом разрешить его использование в системных настройках и перезагрузить хакинтош со сбросом NVRAM. Естественно переди использованием VoodooHDA нужно удалить AppleALC.

С VoodooHDA звук у меня также заработал только через порт на задней панели корпуса. Я попробовал использовать утилиту `getdump` и PDF инструкцию, которые находятся в том же репозитории VoodooHDA, но это мне не помогло. Потом я попросил помощи на форуме applelife предоставив дамп, выданный вышеуказанной утилитой `getdump` и `@slice` вот что сказал на счет моей ситуации:

> Проблема в том, что этот кодек имеет всего три DAC, и они все три заняты под три линейных выхода зеленый, черный, оранжевый, чтобы сделать систему 5.1. Для наушников свободного ЦАПа нет.
> ```
> Tracing association 1 (4)
>  Tracing pin 27 with min nid 0
>    nid 12 busy by association 0
>    nid 13 busy by association 0
>    nid 14 busy by association 0
>  Unable to trace pin 27 seq 0 with min nid 0
> Association 1 (4) trace failed
> ```
> Выход из положения: запретить ноду 22, к примеру, оранжевый выход, тогда ЦАП 14 освободится для наушников.

После этого я модифицировал файл `Info.plist` внутри кекста VoodooHDA и после этого звук с передней панели корпуса заработал.

Если вы тоже столкнулись с проблемой того, что не все аудио порты работают при использовании кекста AppleALC, то вы можете создать свой лэйаут, в котором будут настроены каналы и работа аудио через этот кекст. Есть обширный гайд на эту тему на английском языке - https://github.com/5T33Z0/AppleALC-Guides

Но есть еще один нюанс. Подключение звука с передней панели бывает двух типов - `AC97` и `HD Audio`. Если у вас звук с переднйе панели корпуса подключается к материнской палте по "стандарту" `AC97`, то не будет работать автоматическое определение подключения аудиоустройства к передней панели и отключение звук через аудио порт на задней панели. В любых операционных системах. И у меня как раз такая ситуация.


### Установка нескольких операционных систем

Подробно про использование нескольких операционных систем (мультизагрузку), можно почитать на [отдельном разделе](https://dortania.github.io/OpenCore-Multiboot/) на dortania.

Когда вы более-менее нормально настроили macOS, можно приступать к установке и настройке других операционных систем. Как я писал, у меня установлены следующие ОС:
- macOS Monterey 12.6.1
  - [есть нюансы](about-work-systems.md)
- macOS Mojave 10.14.6
- Windows 10 22H2
  - [есть нюансы](about-work-systems.md)
- Ubuntu 22

Прежде чем приступать к установке других операционных систем, нужно конечно же отделить для них место, если вы не сделали это ранее и если устанавливаете их на тот же накопитель, на который установлена macOS Monterey. Для macOS Mojave нужно будет создать том с файловой системой APFS, а для Windows и Linux нужно будет создать разделы с файловой системой FAT и при установке эти ОС уже отформатируют разделы в нужные для них файловые системы.

Чтобы из OpenCore установить macOS Mojave, нужно в конфиге в разделе `APFS` не забывать выставить значения `-1` для пунктов `MinVersion` и `MinDate`.

Чтобы из OpenCore установить Windows, то ничего особенного делать не нужно, главное проверить, чтобы параметр `ScanPolicy` был настроен на сканирование `ESP` (потому что загрузчик Windows находится на ESP), либо выставить значение `0` Для этого параметра тогда будет сканироваться все (но это чуть дольше). И потом устанавливать Windows как обычно на выделенный ей раздел и после установки в меню OpenCore появится пункт с этой операционной системой.

Чтобы из OpenCore установить Linux, нужно будет добавить 2 драйвера `ext4_x64.efi` (ну или драйвер файловой системы `btrfs_x64.efi`, если ваш дистрибутив использует ее) и `OpenLinuxBoot.efi`. Первый находится в репозитории [OcBinaryData](https://github.com/acidanthera/OcBinaryData), а второй в архиве с OpenCore. И потом устанавливать Linux как обычно на выделенный ей раздел и после установки в меню OpenCore появится пункт с этой операционной системой.

### Что потом

А потом тесты, тесты, тесты... И настройка рабочего пространства в операционных системах, если результаты тестов вас устраивают.

Когда я проводил тесты в бенчмарках в macOS Monterey, потом macOS Mojave, потом в Windows 10, то заметил, что в Windows в Cinebench R23 набирается на ~1000 баллов меньше, чем в macOS. Я начал поочередно отключать примененные в конфиге настройки и в итоге выяснил, что это в Windows происходит из-за моего патченного DSDT, а точнее из-за удаления из DSDT лишних сокетов и ядер. Это происходит из-за того, что OpenCore внедряет файлы `.aml` из папки ACPI во все операционные системы, которые запускает. Давно было предложение и [Pull Request](https://github.com/acidanthera/OpenCorePkg/pull/147) на то, чтобы внедрять правки ACPI только в macOS, но философия разработчиков OpenCore такова, что правки ACPI нужно делать универсальными для всех операционных систем и разграничивать эти правки, например, с помощью методов `_OSI`. А как разграничить наличие и отсутствие целых девайсов в DSDT для разных систем?

Благо людей, которые не хотели внедрения ACPI патчей во все системы было много и появился проект OpenCore Mod, сначала на [insanelymac](https://www.insanelymac.com/forum/topic/341402-customized-opencore-with-additional-features/), а теперь этот проект поддерживает китайский разработчик в [своем репозитории](https://gitee.com/btwise/OpenCore_NO_ACPI) и собранные/скомпилированные версии OpenCore Mod можно найти в той же теме на insanelymac, либо в [отдельном репозитории](https://github.com/wjz304/OpenCore_NO_ACPI_Build). Этот OpenCore Mod No ACPI добавляет 3 ключа в конфиге:
```
ACPI -> Quirks -> EnableForAll
Booter -> Quirks -> EnableForAll

<key>EnableForAll</key>
<false/>
```
и третий ключ `Misc -> Boot -> SkipCustomEntryCheck` о котором упоминается [тут](https://www.insanelymac.com/forum/topic/341402-customized-opencore-with-additional-features/page/41/#comment-2718056) но этого ключа нет в стандартном `Sample.plist`

Поэтому я использовал некоторое время модифицированную версию OpenCore, но с какого-то момент столкнулся с проблемой, что Windows запускается не с первого раза, а если запускается то сначала в режиме восстановления и чтобы этого избежать приходится Windows всегда запускать из меню BIOS/UEFI. Подробнее об этом писал в [отдельном файле](about-work-systems.md).

На странице гайда OC Little Translated есть отличный [список](https://5t33z0.gitbook.io/oc-litte-translated/oc-little/utilities-and-resources) утилит, которые помогут вам в настройке хакинтоша ну и когда вы все настроите, то на ютубе есть немало видео о том, как непосредственно macOS настроить. сделать удобной для себя с помощью стандартных настроек и сторонних программ.

### Что делать если непонятно

Если кому-то что-то непонятно, изучайте документацию, читайте гайды/уроки/другие инструкции, "курите мануалы", надеюсь у вас хватит времени и терпения. 

Естественно регистрируйтесь на форумах и грамотно оформляйте вопросы, если хотите, чтобы на ваш вопрос обратили внимание. Список форумов и гайдов есть в [отдельном файле](hackintosh-resources.md)

### Итог

[Если бы не](about-work-systems.md) рандомно появляющиеся подтормаживания-зависания действий в macOS Monterey и нормальный запуск Windows через OpenCore, то я бы сказал, что это удачная установка хакинтоша, но я так сказать не могу.

Возможно очередная переустановка Windows 10 и macOS Monterey исправит эти проблемы, но я не хочу тратить время на это, я меняю платформу на x99